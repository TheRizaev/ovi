from django.core.management.base import BaseCommand
from django.contrib.auth.models import User
from main.models import NewsCategory, News, Partner
from datetime import datetime, timedelta

class Command(BaseCommand):
    help = '–°–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–∞–π—Ç–∞ OVI'

    def handle(self, *args, **options):
        # –°–æ–∑–¥–∞–µ–º —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        if not User.objects.filter(username='admin').exists():
            User.objects.create_superuser('admin', 'admin@ovi.uz', 'admin')
            self.stdout.write(self.style.SUCCESS('–°–æ–∑–¥–∞–Ω —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: admin/admin'))

        # –°–æ–∑–¥–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–æ–≤–æ—Å—Ç–µ–π
        categories = [
            {'name': '–û –∫–æ–º–ø–∞–Ω–∏–∏', 'slug': 'company'},
            {'name': '–ü—Ä–æ–¥—É–∫—Ç', 'slug': 'product'},
            {'name': '–ü–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–∞', 'slug': 'partnerships'},
            {'name': '–ù–∞–≥—Ä–∞–¥—ã', 'slug': 'awards'},
        ]
        
        for cat_data in categories:
            category, created = NewsCategory.objects.get_or_create(
                slug=cat_data['slug'],
                defaults={'name': cat_data['name']}
            )
            if created:
                self.stdout.write(f'–°–æ–∑–¥–∞–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è: {category.name}')

        # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –Ω–æ–≤–æ—Å—Ç–∏
        admin_user = User.objects.get(username='admin')
        
        news_data = [
            {
                'title': 'OVI –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç $5 –º–ª–Ω –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –≤ —Ä–µ–≥–∏–æ–Ω–µ',
                'slug': 'ovi-investment-5m',
                'excerpt': '–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ OVI —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤–ª–µ–∫–ª–∞ 5 –º–∏–ª–ª–∏–æ–Ω–æ–≤ –¥–æ–ª–ª–∞—Ä–æ–≤ –≤ —Ä–∞–º–∫–∞—Ö —Ä–∞—É–Ω–¥–∞ Series A.',
                'content': '''–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ OVI —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤–ª–µ–∫–ª–∞ 5 –º–∏–ª–ª–∏–æ–Ω–æ–≤ –¥–æ–ª–ª–∞—Ä–æ–≤ –≤ —Ä–∞–º–∫–∞—Ö —Ä–∞—É–Ω–¥–∞ Series A. 
                –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –ø–æ–∑–≤–æ–ª—è—Ç —Ä–∞—Å—à–∏—Ä–∏—Ç—å –≥–µ–æ–≥—Ä–∞—Ñ–∏—é —É—Å–ª—É–≥, —É–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –≤—Ä–∞—á–µ–π –∏ –≤–Ω–µ–¥—Ä–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ 
                –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è.
                
                –°—Ä–µ–¥—Å—Ç–≤–∞ –±—É–¥—É—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞:
                - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤
                - –†–∞–∑—Ä–∞–±–æ—Ç–∫—É –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                - –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏ –ø–æ–∫—Ä—ã—Ç–∏—è
                - –£–ª—É—á—à–µ–Ω–∏–µ –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã''',
                'category': 'company',
                'is_featured': True,
            },
            {
                'title': '–í –∫–æ–º–∞–Ω–¥—É OVI –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å 15 –Ω–æ–≤—ã—Ö –≤—Ä–∞—á–µ–π',
                'slug': 'new-doctors-team',
                'excerpt': '–ú—ã –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞—Å—à–∏—Ä—è—Ç—å –∫–æ–º–∞–Ω–¥—É –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤.',
                'content': '''–í –º–∞–µ –∫ –∫–æ–º–∞–Ω–¥–µ OVI –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å 15 –≤—Ä–∞—á–µ–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π. 
                –°—Ä–µ–¥–∏ –Ω–æ–≤—ã—Ö –∫–æ–ª–ª–µ–≥ - –∫–∞—Ä–¥–∏–æ–ª–æ–≥–∏, —Ç–µ—Ä–∞–ø–µ–≤—Ç—ã, –ø–µ–¥–∏–∞—Ç—Ä—ã –∏ –Ω–µ–≤—Ä–æ–ª–æ–≥–∏ —Å –±–æ–ª—å—à–∏–º –æ–ø—ã—Ç–æ–º —Ä–∞–±–æ—Ç—ã.
                
                –í—Å–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —Ç—â–∞—Ç–µ–ª—å–Ω—ã–π –æ—Ç–±–æ—Ä –∏ –æ–±—É—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–µ —Å –Ω–∞—à–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π.''',
                'category': 'product',
                'is_featured': False,
            },
            {
                'title': '–ó–∞–ø—É—Å–∫ –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫–∞ –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏',
                'slug': 'ai-assistant-launch',
                'excerpt': '–ù–æ–≤—ã–π –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫ –ø–æ–º–æ–∂–µ—Ç –ø–∞—Ü–∏–µ–Ω—Ç–∞–º –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.',
                'content': '''OVI –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–∂–µ—Ç –ø–∞—Ü–∏–µ–Ω—Ç–∞–º –ø–æ–ª—É—á–∏—Ç—å 
                –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å–∏–º–ø—Ç–æ–º–∞–º –ø–µ—Ä–µ–¥ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–µ–π —Å –≤—Ä–∞—á–æ–º.
                
                –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–º–æ—â–Ω–∏–∫–∞:
                - –ê–Ω–∞–ª–∏–∑ —Å–∏–º–ø—Ç–æ–º–æ–≤ –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
                - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å—Ä–æ—á–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –≤—Ä–∞—á—É
                - –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏''',
                'category': 'product',
                'is_featured': False,
            }
        ]
        
        for news_item in news_data:
            category = NewsCategory.objects.get(slug=news_item['category'])
            news, created = News.objects.get_or_create(
                slug=news_item['slug'],
                defaults={
                    'title': news_item['title'],
                    'excerpt': news_item['excerpt'],
                    'content': news_item['content'],
                    'category': category,
                    'author': admin_user,
                    'is_featured': news_item['is_featured'],
                    'is_published': True,
                }
            )
            if created:
                self.stdout.write(f'–°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–æ—Å—Ç—å: {news.title}')

        # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
        partners_data = [
            {
                'name': '–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä "MedCenter"',
                'slug': 'medcenter',
                'category': 'clinics',
                'description': '–ú–Ω–æ–≥–æ–ø—Ä–æ—Ñ–∏–ª—å–Ω—ã–π –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º –∏ –æ–ø—ã—Ç–Ω—ã–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏.',
                'services': '''–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤
–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
–ê–º–±—É–ª–∞—Ç–æ—Ä–Ω–æ–µ –ª–µ—á–µ–Ω–∏–µ
–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å–º–æ—Ç—Ä—ã''',
                'contact_info': 'üìç —É–ª. –ù–∞–≤–æ–∏, 15 | üìû +998 71 123-45-67',
            },
            {
                'name': '–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è "MedLab"',
                'slug': 'medlab',
                'category': 'labs',
                'description': '–í–µ–¥—É—â–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è —Å –ø–æ–ª–Ω—ã–º —Å–ø–µ–∫—Ç—Ä–æ–º –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏—Ö –∞–Ω–∞–ª–∏–∑–æ–≤.',
                'services': '''–û–±—â–µ–∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–µ –∞–Ω–∞–ª–∏–∑—ã
–ë–∏–æ—Ö–∏–º–∏—á–µ—Å–∫–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
–ì–æ—Ä–º–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
–ú–∏–∫—Ä–æ–±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∞–Ω–∞–ª–∏–∑—ã''',
                'contact_info': 'üìç —É–ª. –ë—É—é–∫ –ò–ø–∞–∫ –ô—É–ª–∏, 12 | üìû +998 71 456-78-90',
            },
            {
                'name': '–ê–ø—Ç–µ—á–Ω–∞—è —Å–µ—Ç—å "Pharma+"',
                'slug': 'pharma-plus',
                'category': 'pharmacies',
                'description': '–ö—Ä—É–ø–Ω–µ–π—à–∞—è –∞–ø—Ç–µ—á–Ω–∞—è —Å–µ—Ç—å –≥–æ—Ä–æ–¥–∞ —Å —à–∏—Ä–æ–∫–∏–º –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–æ–º –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤.',
                'services': '''–†–µ—Ü–µ–ø—Ç—É—Ä–Ω—ã–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã
–ë–ê–î—ã –∏ –≤–∏—Ç–∞–º–∏–Ω—ã
–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∏–∑–¥–µ–ª–∏—è
–ö–æ—Å–º–µ—Ç–∏–∫–∞ –∏ –≥–∏–≥–∏–µ–Ω–∞''',
                'contact_info': 'üìç 20+ —Ñ–∏–ª–∏–∞–ª–æ–≤ –ø–æ –≥–æ—Ä–æ–¥—É | üìû +998 71 678-90-12',
            }
        ]
        
        for partner_data in partners_data:
            partner, created = Partner.objects.get_or_create(
                slug=partner_data['slug'],
                defaults=partner_data
            )
            if created:
                self.stdout.write(f'–°–æ–∑–¥–∞–Ω –ø–∞—Ä—Ç–Ω–µ—Ä: {partner.name}')

        self.stdout.write(self.style.SUCCESS('–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã!'))